<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ebced HesaplayÄ±cÄ± â€” Ta Merbuta GÃ¼ncel</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Amiri', serif; background: linear-gradient(145deg,#f5f7fa,#e4ebf5); color:#222; margin:0; padding:0; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; padding-top:40px; }
    .container { background:#fff; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.08); padding:24px 30px; width:520px; max-width:95%; text-align:right; }
    h1{ font-size:1.6em; color:#0d3b66; margin:0 0 10px 0; text-align:center; direction:rtl; }
    input[type="text"]{ width:100%; padding:10px; font-size:1.05em; border-radius:8px; border:1px solid #ccc; box-sizing:border-box; }
    label { display:block; margin:8px 0; font-size:0.95em; text-align:right; }
    .controls { display:flex; gap:8px; justify-content:flex-end; margin-top:8px; flex-wrap:wrap; }
    button{ background:#0d3b66; color:#fff; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-size:0.95em; }
    button:hover{ background:#09406b; }
    .dynamic { background:#f0f4ff; padding:8px; border-radius:8px; margin-top:10px; font-size:0.95em; max-height:160px; overflow:auto; }
    .analysis span{ padding:3px 6px; border-radius:4px; }
    .shadda{ background:#ffeeba; }
    .tanwin{ background:#c3e6cb; }
    .silent{ background:#f8d7da; }
    .normal{ background:#e1e8f0; }
    .result{ margin-top:12px; background:#fff8dc; padding:10px; border-radius:8px; color:#8b4513; font-size:0.95em; text-align:right; }
    table{ width:100%; border-collapse:collapse; margin-top:12px; font-size:0.9em; }
    th,td{ border:1px solid #ccc; padding:6px; text-align:center; }
    th{ background:#0d3b66; color:#fff; }
    small{ color:#555; display:block; margin-top:4px; text-align:right; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“– Ebced HesaplayÄ±cÄ± & TÃ¼rkÃ§e Ã‡eviri</h1>

    <label for="wordInput">Bir ArapÃ§a kelime veya ifade giriniz:</label>
    <input id="wordInput" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù„Ù‡ / ÙƒÙØªÙØ§Ø¨ÙŒ / Ù†ØµØ±">

    <label><input type="checkbox" id="includeSilent"> Okunmayan harfleri <b>dahil et</b></label>
    <label><input type="checkbox" id="taMerbutaAsHa"> Ta Merbuta (Ø©) harfini â€œÙ‡â€ olarak say</label>

    <div class="controls">
      <button id="scanBtn">Ä°ÅŸaretleri Tara</button>
      <button id="calcBtn">Hesapla</button>
      <button id="copyResBtn">Sonucu Kopyala</button>
      <button id="manualAddBtn">Manuel Sonucu Tabloya Ekle</button>
      <button id="exportBtn">Excel Ä°ndir</button>
    </div>

    <div id="dynamicArea" class="dynamic" aria-live="polite"></div>
    <div id="result" class="result" style="display:none;" contenteditable="true"></div>

    <h3 style="margin-top:14px;">GeÃ§miÅŸ</h3>
    <table id="historyTable">
      <tr>
        <th>Kelime</th><th>Okunmayan</th><th>Åeddeler</th><th>Tenvinler</th>
        <th>Toplam Ebced</th><th>HicrÃ® â†’ MilÃ¢dÃ®</th><th>RÃ»mÃ® â†’ MilÃ¢dÃ®</th><th>Ã‡eviri</th>
      </tr>
    </table>
  </div>

  <script>
  const ebcedValues = {
    'Ø§':1,'Ø£':1,'Ø¥':1,'Ø¢':1,'Ø¨':2,'Ø¬':3,'Ø¯':4,'Ù‡':5,
    'Ùˆ':6,'Ø²':7,'Ø­':8,'Ø·':9,'ÙŠ':10,'Ùƒ':20,'Ù„':30,'Ù…':40,'Ù†':50,
    'Ø³':60,'Ø¹':70,'Ù':80,'Øµ':90,'Ù‚':100,'Ø±':200,'Ø´':300,'Øª':400,
    'Ø«':500,'Ø®':600,'Ø°':700,'Ø¶':800,'Ø¸':900,'Øº':1000,
    'Ø¡':1,'Ø¤':6,'Ø¦':10,'Ù‰':1
  };
  const sunLetters = "ØªØ«Ø¯Ø°Ø±Ø²Ø³Ø´ØµØ¶Ø·Ø¸Ù„Ù†";
  const tanwinMarks = ['Ù‹','Ù','ÙŒ'];

  function isSilentLetter(word, i) {
    const letter = word[i]; const next = word[i+1]||''; const prev = word[i-1]||'';
    if(i===0 && letter==='Ø§' && !'Ø¥Ø£Ø¢'.includes(letter)) return true;
    if(letter==='Ù„' && prev==='Ø§' && sunLetters.includes(next)) return true;
    if(letter==='Ø§' && prev==='Ùˆ' && i===word.length-1) return true;
    if(letter==='Ø§' && prev==='Ù„' && next==='Ùˆ') return true;
    if(letter==='Ù‰') return false;
    if(i===0 && letter==='Ø§' && next==='Ø¨' && word.startsWith('Ø§Ø¨Ù†')) return true;
    return false;
  }

  function hijriToGregorian(h){ if(typeof h!=='number'||!isFinite(h))return ''; return h+622-Math.floor(h/33);}
  function rumiToGregorian(r){ if(typeof r!=='number'||!isFinite(r))return ''; return r+584;}
  function translateToTurkish(word){
    const dictionary={'Ø§Ù„Ù„Ù‡':'Allah','ÙƒØªØ§Ø¨':'Kitap','Ù†ØµØ±':'Zafer','Ø³Ù„Ø§Ù…':'Selam','Ù…Ø­Ù…Ø¯':'Muhammed'};
    return dictionary[word]||'Ã‡eviri bulunamadÄ±';
  }

  let history=[];
  const wordInput=document.getElementById('wordInput');
  const dynamicArea=document.getElementById('dynamicArea');
  const includeSilentCheckbox=document.getElementById('includeSilent');
  const taMerbutaAsHaCheckbox=document.getElementById('taMerbutaAsHa');
  const scanBtn=document.getElementById('scanBtn');
  const calcBtn=document.getElementById('calcBtn');
  const copyResBtn=document.getElementById('copyResBtn');
  const exportBtn=document.getElementById('exportBtn');
  const manualAddBtn=document.getElementById('manualAddBtn');
  const resultDiv=document.getElementById('result');
  const historyTable=document.getElementById('historyTable');

  function scanMarksAndBuildUI(){
    const word=wordInput.value.trim(); dynamicArea.innerHTML=''; resultDiv.style.display='none';
    if(!word){ dynamicArea.innerHTML='<small>Ã–nce bir kelime girin ve sonra "Ä°ÅŸaretleri Tara"ya basÄ±n.</small>'; return; }
    let shaddaCount=0, tanwinCount=0;
    for(let ch of word){ if(ch==='Ù‘')shaddaCount++; if(tanwinMarks.includes(ch))tanwinCount++; }
    dynamicArea.innerHTML=`<div><small>Kelime: <b>${word}</b></small></div>`;
    if(shaddaCount>0){ const shHtml=['<div style="margin-top:8px;"><b>Åedde SeÃ§imleri:</b>'];
      for(let i=1;i<=shaddaCount;i++){ shHtml.push(`<label><input type="checkbox" id="chk_shadda_${i}" checked> Åedde ${i} dahil et</label>`);}
      shHtml.push('</div>'); dynamicArea.innerHTML+=shHtml.join(''); }
    else{ dynamicArea.innerHTML+=`<div><small>Bu kelimede ÅŸedde bulunmuyor.</small></div>`; }
    if(tanwinCount>0){ const tnHtml=['<div style="margin-top:8px;"><b>Tenvin SeÃ§imleri:</b>'];
      for(let i=1;i<=tanwinCount;i++){ tnHtml.push(`<label><input type="checkbox" id="chk_tanwin_${i}" checked> Tenvin ${i} â€œÙ†â€ olarak dahil et</label>`);}
      tnHtml.push('</div>'); dynamicArea.innerHTML+=tnHtml.join(''); }
    else{ dynamicArea.innerHTML+=`<div><small>Bu kelimede tenvin bulunmuyor.</small></div>`;}
    dynamicArea.innerHTML+=`<div style="margin-top:8px;"><small>Not: Åedde, solundaki harfin deÄŸerini tekrar ekler.</small></div>`;
  }

  function calculateEbced(){
    const rawWord=wordInput.value.trim(); if(!rawWord){alert('LÃ¼tfen bir ArapÃ§a kelime giriniz.');return;}
    const includeSilent=includeSilentCheckbox.checked; const taAsHa=taMerbutaAsHaCheckbox.checked;
    let word=rawWord.replace(/Ø©/g, taAsHa?'Ù‡':'Øª');
    let total=0, details=[], ignoredLetters=[], shaddaStatuses=[], tanwinStatuses=[];
    let shIndex=0, tnIndex=0, analysisHtml='';
    for(let i=0;i<word.length;i++){
      const ch=word[i];
      if(ch==='Ù‘'){ shIndex++; const chk=document.getElementById(`chk_shadda_${shIndex}`);
        const prev=word[i-1]||''; if(chk&&chk.checked&&prev&&ebcedValues[prev]){total+=ebcedValues[prev]; shaddaStatuses.push(`Åedde${shIndex}: Dahil`);}
        else{shaddaStatuses.push(`Åedde${shIndex}: HariÃ§`);} analysisHtml+=`<span class="shadda">Ù‘</span>`; continue; }
      if(tanwinMarks.includes(ch)){ tnIndex++; const chk=document.getElementById(`chk_tanwin_${tnIndex}`);
        if(chk&&chk.checked){total+=ebcedValues['Ù†']; tanwinStatuses.push(`Tenvin${tnIndex}: Dahil`);}
        else{tanwinStatuses.push(`Tenvin${tnIndex}: HariÃ§`);} analysisHtml+=`<span class="tanwin">${ch}</span>`; continue; }
      if(!ebcedValues[ch]){ analysisHtml+=`<span class="normal">${ch}</span>`; continue;}
      if(!includeSilent&&isSilentLetter(word,i)){ignoredLetters.push(ch); analysisHtml+=`<span class="silent">${ch}</span>`; continue;}
      total+=ebcedValues[ch]; details.push(`${ch}:${ebcedValues[ch]}`); analysisHtml+=`<span class="normal">${ch}</span>`;
    }
    const showDates=total<=1600; const hijriYear=total, rumiYear=total;
    const miladiFromHijri=showDates?hijriToGregorian(hijriYear):'';
    const miladiFromRumi=showDates?rumiToGregorian(rumiYear):'';
    const translation=translateToTurkish(rawWord);
    resultDiv.style.display='block';
    resultDiv.innerHTML=`
      <div style="text-align:right;">
        <div class="analysis">${analysisHtml}</div>
        <b>Kelime:</b> ${rawWord}<br>
        <b>Toplam Ebced DeÄŸeri:</b> ${total}<br>
        <small>${details.join(' + ')}</small><br>
        ${shaddaStatuses.length?`<small>ğŸ” ${shaddaStatuses.join(', ')}</small><br>`:''}
        ${tanwinStatuses.length?`<small>â• ${tanwinStatuses.join(', ')}</small><br>`:''}
        ${ignoredLetters.length?`<small>ğŸš« SayÄ±lmayan harfler: ${ignoredLetters.join(', ')}</small><br>`:''}
        <div style="margin-top:8px; background:#f0f4ff; padding:8px; border-radius:6px;">
          ${showDates?`<b>ğŸ•Œ HicrÃ®:</b> ${hijriYear} â†’ <b>${miladiFromHijri}</b><br>
          <b>ğŸ“… RÃ»mÃ®:</b> ${rumiYear} â†’ <b>${miladiFromRumi}</b>`:`<i>1600â€™den bÃ¼yÃ¼k olduÄŸu iÃ§in tarih dÃ¶nÃ¼ÅŸÃ¼mÃ¼ yok.</i>`}
        </div>
        <div style="margin-top:8px;"><b>TÃ¼rkÃ§e Ã‡eviri:</b> ${translation}</div>
      </div>`;
    const row={kelime:rawWord,okunmayan:includeSilent?'Dahil':'HariÃ§',shaddes:shaddaStatuses.join(' | '),
      tenvins:tanwinStatuses.join(' | '),toplamEbced:total,hicriMiladi:miladiFromHijri,rumiMiladi:miladiFromRumi,ceviri:translation};
    history.push(row);
    const tr=historyTable.insertRow();
    [row.kelime,row.okunmayan,row.shaddes,row.tenvins,row.toplamEbced,row.hicriMiladi,row.rumiMiladi,row.ceviri].forEach(v=>{const td=tr.insertCell(); td.innerText=v;});
  }

  function addManualResultToTable(){
    if(!resultDiv.innerText.trim()){alert('Ã–nce hesaplayÄ±n veya manuel metin girin.'); return;}
    const rawWord=wordInput.value.trim()||'---';
    const includeSilent=includeSilentCheckbox.checked?'Dahil':'HariÃ§';
    const shAdds=Array.from(document.querySelectorAll('[id^="chk_shadda_"]')).map(c=>c.checked?'Dahil':'HariÃ§');
    const tnAdds=Array.from(document.querySelectorAll('[id^="chk_tanwin_"]')).map(c=>c.checked?'Dahil':'HariÃ§');
    const manualText=resultDiv.innerText.trim();
    // Manuel metinde ilk sayÄ±yÄ± al
    const manualNumber=parseInt(manualText.match(/\d+/)?.[0]||'');
    let miladiFromHijri='---', miladiFromRumi='---';
    if(!isNaN(manualNumber)){
        miladiFromHijri=hijriToGregorian(manualNumber);
        miladiFromRumi=rumiToGregorian(manualNumber);
    }
    const tr=historyTable.insertRow();
    [rawWord, includeSilent, shAdds.join(' | '), tnAdds.join(' | '), manualText, miladiFromHijri, miladiFromRumi, 'Manuel GiriÅŸ'].forEach(v=>{
      const td=tr.insertCell(); td.innerText=v;
    });
    alert('Manuel sonuÃ§ tabloya eklendi ve tarih dÃ¶nÃ¼ÅŸtÃ¼rÃ¼ldÃ¼.');
  }

  function exportToCSV(){
    if(history.length===0){alert('HenÃ¼z veri yok.');return;}
    const blob=new Blob(["\uFEFF"+history.map(r=>[r.kelime,r.okunmayan,r.shaddes,r.tenvins,r.toplamEbced,r.hicriMiladi,r.rumiMiladi,r.ceviri].join(';')).join('\r\n')],
        {type:"text/csv;charset=utf-8;"});
    const link=document.createElement('a'); link.href=URL.createObjectURL(blob);
    link.download='ebced_tamerbuta_guncel.csv'; document.body.appendChild(link); link.click(); document.body.removeChild(link);
  }

  function copyResultToClipboard(){
    if(!resultDiv.innerText.trim()){alert('Ã–nce hesaplayÄ±n.'); return;}
    navigator.clipboard?.writeText(resultDiv.innerText).then(()=>alert('SonuÃ§ panoya kopyalandÄ±.'));
  }

  scanBtn.addEventListener('click',scanMarksAndBuildUI);
  calcBtn.addEventListener('click',calculateEbced);
  manualAddBtn.addEventListener('click',addManualResultToTable);
  exportBtn.addEventListener('click',exportToCSV);
  copyResBtn.addEventListener('click',copyResultToClipboard);
  wordInput.addEventListener('input',()=>{dynamicArea.innerHTML='<small>DeÄŸiÅŸiklik yapÄ±ldÄ±. "Ä°ÅŸaretleri Tara"ya basÄ±n.</small>'; resultDiv.style.display='none';});
  dynamicArea.innerHTML='<small>Kelime yazÄ±p "Ä°ÅŸaretleri Tara"ya basÄ±n â€” her ÅŸedde/tenvin iÃ§in kutu oluÅŸur.</small>';
  </script>
</body>
</html>
